{"pageProps":{"post":{"title":"アニメーションを使いまわすための「motion+Slot」戦略","date":"2022-07-01","slug":"motion-slot","content":"<p>https://stitches.dev/</p>\n<h2 id=\"概要\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#概要\"><span class=\"icon icon-link\"></span></a>概要</h2>\n<p>Framer MotionをReact Slotで運用すると、アニメーションの再利用性が飛躍的に向上します。</p>\n<h3 id=\"react-slot\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#react-slot\"><span class=\"icon icon-link\"></span></a>React Slot</h3>\n<p>https://www.radix-ui.com/docs/primitives/utilities/slot</p>\n<p><code>Slot</code>は子コンポーネントにpropsを渡す役割を持ちます。</p>\n<p>これが</p>\n<pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Slot</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">&#x3C;AnyComponent /></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">Slot</span></span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<p>実質的にこうなります。</p>\n<pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">AnyComponent</span></span> <span class=\"token attr-name\">color</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>red<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n</code></pre>\n<p><code>Slot</code>本体は消えるものの、propsを介して任意のコンポーネントに機能を与えられるという点が重要です。余分な<code>div</code>を生成することはありません。</p>\n<p>詳しくは<a href=\"https://zenn.dev/subt/articles/b6aa48ccb0c884\">こちら</a>を参照ください。</p>\n<h3 id=\"framer-motion\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#framer-motion\"><span class=\"icon icon-link\"></span></a>Framer Motion</h3>\n<p>https://www.framer.com/motion</p>\n<p><a href=\"https://www.framer.com/\">Framer</a>が提供しているアニメーションライブラリです。</p>\n<p>どんなアニメーションでも、基本的に<strong>propsだけ</strong>で完結してしまうのが特徴です。</p>\n<pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>motion.div</span>\n  <span class=\"token attr-name\">drag</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>x<span class=\"token punctuation\">\"</span></span>\n  <span class=\"token attr-name\">dragConstraints</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> left<span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> right<span class=\"token operator\">:</span> <span class=\"token number\">100</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">whileHover</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> scale<span class=\"token operator\">:</span> <span class=\"token number\">1.1</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n  <span class=\"token attr-name\">whileTap</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> scale<span class=\"token operator\">:</span> <span class=\"token number\">0.9</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span>\n<span class=\"token punctuation\">/></span></span>\n</code></pre>\n<p>カスタムコンポーネントは<code>motion</code>関数に渡してアニメーションをつけます。</p>\n<pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">MotionComponent</span> <span class=\"token operator\">=</span> <span class=\"token function\">motion</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">Component</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token spread operator\">...</span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">MotionComponent</span></span> <span class=\"token attr-name\">animate</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> scale<span class=\"token operator\">:</span> <span class=\"token number\">0.5</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n</code></pre>\n<h2 id=\"motionslotで何ができる\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#motionslotで何ができる\"><span class=\"icon icon-link\"></span></a><code>motion</code>+<code>Slot</code>で何ができる？</h2>\n<p><code>motion</code>と<code>Slot</code>を組み合わせて<code>motion(Slot)</code>を作ります。すると、</p>\n<p><code>motion</code>が提供してくれる手軽でリッチなアニメーション機能をそのまま、提供元を完全に隠蔽して提供する</p>\n<p>ことができるようになります。</p>\n<p>何を言っているのか、私もよくわからないので具体例に移りましょう。</p>\n<h2 id=\"具体例\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#具体例\"><span class=\"icon icon-link\"></span></a>具体例</h2>\n<p><code>motion(Slot)</code>を使って、みんな大好き「<a href=\"https://qiita.com/yuneco/items/24a209cb14661b8a7a20\">ふわっ</a>」が手軽に実装できるようにしましょう。</p>\n<h3 id=\"実装\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#実装\"><span class=\"icon icon-link\"></span></a>実装</h3>\n<pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token maybe-class-name\">React</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> <span class=\"token maybe-class-name\">Slot</span> <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'@radix-ui/react-slot'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> motion <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'framer-motion'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">ContentLayout</span> <span class=\"token operator\">=</span> <span class=\"token function\">motion</span><span class=\"token punctuation\">(</span><span class=\"token maybe-class-name\">Slot</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\"><span class=\"token maybe-class-name\">Custom</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  y<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  once<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">boolean</span><span class=\"token punctuation\">;</span>\n  amount<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  duration<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> defaultCustom<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Custom</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  y<span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n  once<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  amount<span class=\"token operator\">:</span> <span class=\"token number\">0.3</span><span class=\"token punctuation\">,</span>\n  duration<span class=\"token operator\">:</span> <span class=\"token number\">0.6</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>custom<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Custom</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ComponentProps</span></span><span class=\"token operator\">&#x3C;</span><span class=\"token keyword\">typeof</span> <span class=\"token maybe-class-name\">ContentLayout</span><span class=\"token operator\">></span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> y<span class=\"token punctuation\">,</span> once<span class=\"token punctuation\">,</span> amount<span class=\"token punctuation\">,</span> duration <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token spread operator\">...</span>defaultCustom<span class=\"token punctuation\">,</span> <span class=\"token spread operator\">...</span>custom <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n    initial<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      opacity<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      y<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    whileInView<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      opacity<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n      y<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    viewport<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      once<span class=\"token punctuation\">,</span>\n      amount<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    transition<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      duration<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\"><span class=\"token maybe-class-name\">Props</span></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  children<span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ReactNode</span></span><span class=\"token punctuation\">;</span>\n  custom<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">Custom</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword module\">export</span> <span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">Enter</span> <span class=\"token operator\">=</span> <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">forwardRef</span><span class=\"token operator\">&#x3C;</span>\n  <span class=\"token maybe-class-name\">React</span><span class=\"token punctuation\">.</span><span class=\"token property-access\"><span class=\"token maybe-class-name\">ElementRef</span></span><span class=\"token operator\">&#x3C;</span><span class=\"token keyword\">typeof</span> <span class=\"token maybe-class-name\">ContentLayout</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token maybe-class-name\">Props</span>\n<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> children<span class=\"token punctuation\">,</span> custom <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> forwardedRef<span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">ContentLayout</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token spread operator\">...</span><span class=\"token method function property-access\">config</span><span class=\"token punctuation\">(</span>custom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>forwardedRef<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">ContentLayout</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token maybe-class-name\">Enter</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">displayName</span> <span class=\"token operator\">=</span> <span class=\"token string\">'Enter'</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"使い方\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#使い方\"><span class=\"icon icon-link\"></span></a>使い方</h3>\n<p>たったこれだけで、<code>h1</code>がふわっと入場します。</p>\n<pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span><span class=\"token class-name\">Enter</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Hello CodeSandbox</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span>h1</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&#x3C;/</span><span class=\"token class-name\">Enter</span></span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<p>CodeSandboxに使用例を上げました。</p>\n<p>@<a href=\"https://codesandbox.io/embed/nifty-fast-gs8cjy?fontsize=14&#x26;hidenavigation=1&#x26;theme=dark\">codesandbox</a></p>\n<p>ぜひ、別窓で開いて余計な<code>div</code>が生成されていないことをお確かめください。</p>\n<h3 id=\"注意点\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#注意点\"><span class=\"icon icon-link\"></span></a>注意点</h3>\n<p><code>motion</code>は内部的にrefを使用します。なので、対象のコンポーネントがカスタムコンポーネントである場合、正しくrefをフォワーディングしている必要があります。</p>\n<p>refや<code>forwardRef</code>をご存知ない方は、調べてみてください。きっと、<code>Slot</code>や<code>motion</code>に比べてはるかに多くの記事がヒットするでしょう。</p>\n<h2 id=\"まとめ\"><a aria-hidden=\"true\" tabindex=\"-1\" href=\"#まとめ\"><span class=\"icon icon-link\"></span></a>まとめ</h2>\n<p><code>motion(Slot)</code>で再利用性バツグンのアニメーションコンポーネントを作ることができました。</p>\n<p>実装自体<code>motion</code>の軽い延長に過ぎないので、簡単にオリジナルのアニメーションコンポーネントが作れると思います。是非お試しください。</p>\n<p>私も色々実装してみて、またの機会に紹介したいと思います。</p>","ogImage":{"url":"/assets/blog/dynamic-routing/cover.jpg"},"coverImage":"/assets/blog/dynamic-routing/cover.jpg","excerpt":"Framer MotionのmotionコンポーネントとRadix UIのユーティリティのコンポーネントSlotを組み合わせることで、アニメーションの再利用性を爆上げします。","tags":["React","RadixUI","FramerMotion"]}},"__N_SSG":true}